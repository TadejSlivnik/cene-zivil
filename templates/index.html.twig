{% extends 'base.html.twig' %}

{% block body %}

	<div class="max-w-300 centered mx-auto my-20">

		<h1 class="mb-4 mx-2 text-5xl tracking-tight sm:text-6xl text-pretty">{{ title }}</h1>

		<p class="py-5 mx-2 mb-3 text-lg text-gray-500 md:text-xl">Dobrodošli na primerjalniku cen živil, kjer lahko sprejemate premišljene nakupovalne odločitve.</p>

		<form id="search-form" method="get" action="{{ path('index') }}" class="my-5 mx-2 max-w-200">
			<div class="relative">
				<input type="text" name="q" placeholder="Vnesite iskalne izraze..." value="{{ query }}" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
				<button type="submit" class="absolute top-0 end-0 p-2.5 h-full text-sm font-medium text-white bg-blue-700 rounded-e-lg border border-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">
					<svg class="w-4 h-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewbox="0 0 20 20">
						<path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z"/>
					</svg>
				</button>
			</div>
		</form>

		<table id="product-list" class="w-full text-sm text-left rtl:text-right text-gray-500">
			<caption class="py-5 px-2 text-lg font-semibold text-left rtl:text-right text-gray-900 bg-white">
				{% if terms %}
					Seznam izdelkov, ki vsebujejo izraze:
					{{ '"' ~ terms|join('","') ~'"' }}
				{% else %}
					Seznam najbolj znižanih izdelkov
				{% endif %}
			</caption>
			<caption class></caption>

			{% set headers = ['Naziv izdelka', 'Cena na enoto', 'Cena'] %}
			<thead class="sticky top-0 text-gray-700 uppercase bg-gray-100">
				<tr>
					{% for item in headers %}
						<th scope="col" class="cursor-pointer px-2 py-3" aria-label="{{ item }}, kliknite za razvrščanje">
							<div class="flex items-center">
								{{ item }}
								<a href="#">
									<svg class="w-3 h-3 ms-1.5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewbox="0 0 24 24">
										<path d="M8.574 11.024h6.852a2.075 2.075 0 0 0 1.847-1.086 1.9 1.9 0 0 0-.11-1.986L13.736 2.9a2.122 2.122 0 0 0-3.472 0L6.837 7.952a1.9 1.9 0 0 0-.11 1.986 2.074 2.074 0 0 0 1.847 1.086Zm6.852 1.952H8.574a2.072 2.072 0 0 0-1.847 1.087 1.9 1.9 0 0 0 .11 1.985l3.426 5.05a2.123 2.123 0 0 0 3.472 0l3.427-5.05a1.9 1.9 0 0 0 .11-1.985 2.074 2.074 0 0 0-1.846-1.087Z"/>
									</svg>
								</a>
							</div>
						</th>
					{% endfor %}
				</tr>
			</thead>
			<tbody class="text-gray-900 tracking-tighter sm:tracking-normal">
				{% if products %}
					{% for product in products %}
						{% set price = product.price|format_currency('EUR', {decimal_always_shown:true}) %}
						{% set regularPrice = product.regularPrice|format_currency('EUR', {decimal_always_shown:true}) %}
						<tr role="link" tabindex="0" aria-label="Povezava na izdelek {{ product.title }} v trgovini {{ product.trgovina }}" onclick="window.open('{{ product.url }}', '_blank');" onkeydown="if(event.key === 'Enter' || event.key === ' ') { window.open('{{ product.url }}', '_blank'); }" class="cursor-pointer odd:bg-white even:bg-gray-50 border-b border-gray-200 hover:bg-gray-200">
							<td class="px-2 py-1">
								{{ product.title }}
								<br>
								<span class="text-xs text-gray-500 tracking-normal">{{ product.trgovina }}</span>
							</td>
							<td class="px-2 py-1">
								{{ product.unitPrice|format_currency('EUR', {decimal_always_shown:true}) }}
								<span class="text-xs text-gray-500">/
									{{ product.unit }}</span>
							</td>
							<td class="px-2 py-1" data-sort='{{ price }}'>
								{%- if regularPrice != price -%}
									<s class="text-red-600 text-xs">{{ regularPrice }}</s>
									<span class="text-red-600 text-xs">(-{{ product.discount }}%)</span>
									<br>
								{%- endif -%}
								{{ price }}
							</td>
						</tr>
					{% endfor %}
				{% else %}
					<tr>
						<td colspan="4" class="no-results">Ni izdelkov, ki ustrezajo kriterijem.</td>
					</tr>
				{% endif %}
			</tbody>
		</table>
	</div>
{% endblock %}
